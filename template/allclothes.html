<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

<style>
  .navbar { display: flex; flex-wrap: wrap; gap: 10px; }
  .btn-nav { padding: 10px 20px; background-color: #eee; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; transition: 0.3s; }
  .btn-nav.active { background-color: #2563eb; color: white; }
  @media (max-width: 480px) { .btn-responsive { display: none; } }
  body { background-color: #8cc3fd; }
  .filterDiv { float: left; background-color: #2196f3; color: #ffffff; width: 100px; line-height: 100px; text-align: center; margin: 2px; display: none; cursor: pointer; }
  .show { display: block; }
  .container { margin-top: 20px; overflow: hidden; }
  .btn:hover { background-color: #ddd; }
  .btn.active { background-color: #666; color: white; }
  .favorited { border: 3px solid green !important; }
</style>
</head>

<body>

<div id="myBtnContainer" class="flex flex-wrap justify-center gap-4 p-4 bg-white shadow-md rounded-lg">
  <button class="btn-nav" onclick="filterSelection('all')">Show All</button>
  <button class="btn-nav" onclick="filterSelection('shirt')">Shirts</button>
  <button class="btn-nav" onclick="filterSelection('trouser')">Trousers</button>
  <button class="btn-nav" onclick="filterSelection('coat')">Coat</button>
  <button class="btn-nav" onclick="filterSelection('other')">Other</button>
</div>

<div class="container all text-center">
  <div class="row row-cols-auto">
    <div class="filterDiv shirt">shirt</div>
    <div class="filterDiv shirt">shirt</div>
    <div class="filterDiv shirt">shirt</div>
    <div class="filterDiv trouser col p-0">
      <img src="https://cdn.platform.next/common/items/default/default/itemimages/3_4Ratio/product/lge/N18474s.jpg" class="w-100 h-100 object-fit-cover" />
    </div>
    <div class="filterDiv trouser col p-0">
      <img src="https://riseandfall.co/cdn/shop/files/APW-TRWL-CSH-U2-12GG-S-LIA.jpg?v=1744818403&width=700" class="w-100 h-100 object-fit-cover" />
    </div>
    <div class="filterDiv trouser col p-0">
      <img src="https://www.louchelondon.com/cdn/shop/products/ELINA-LILAC-SS23_2.jpg?v=1677499408" class="w-100 h-100 object-fit-cover" />
    </div>
    <div class="filterDiv coat">coat</div>
    <div class="filterDiv coat">coat</div>
    <div class="filterDiv other">other</div>
    <div class="filterDiv other shirt">other/trouser</div>
    <div class="filterDiv other">other</div>
    <div class="filterDiv trouser col p-0">
      <img src="https://www.damart.co.uk/media/catalog/product/cache/e0641f7c62ee91230c5e14755392f1dd/7/5/75177-20918-F-1-HD-3.jpg" class="w-100 h-100 object-fit-cover" />
    </div>
    <div class="filterDiv trouser col p-0">
      <img src="https://busyclothing.co.uk/cdn/shop/products/white44340large_1200x1200.jpg?v=1534517861" class="w-100 h-100 object-fit-cover" />
    </div>
    <div class="filterDiv trouser col p-0">
      <img src="https://m.media-amazon.com/images/I/71Y9RcXbcVL._UY1000_.jpg" class="w-100 h-100 object-fit-cover" />
    </div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC7euLuQsnVFLJTAPvIZY09EQM_envFZeE",
    authDomain: "closet-notes.firebaseapp.com",
    projectId: "closet-notes",
    storageBucket: "closet-notes.firebasestorage.app",
    messagingSenderId: "268969012434",
    appId: "1:268969012434:web:cc9026f73cf7f41742d10b"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // FILTER FUNCTIONS
  filterSelection("all");
  function filterSelection(c) {
    var x = document.getElementsByClassName("filterDiv");
    if (c == "all") c = "";
    for (var i = 0; i < x.length; i++) {
      w3RemoveClass(x[i], "show");
      if (x[i].className.indexOf(c) > -1) w3AddClass(x[i], "show");
    }
  }
  function w3AddClass(element, name) {
    var arr1 = element.className.split(" "), arr2 = name.split(" ");
    for (var i = 0; i < arr2.length; i++) { if (arr1.indexOf(arr2[i]) == -1) element.className += " " + arr2[i]; }
  }
  function w3RemoveClass(element, name) {
    var arr1 = element.className.split(" "), arr2 = name.split(" ");
    for (var i = 0; i < arr2.length; i++) {
      while (arr1.indexOf(arr2[i]) > -1) { arr1.splice(arr1.indexOf(arr2[i]), 1); }
    }
    element.className = arr1.join(" ");
  }

  // BUTTON ACTIVE CLASS
  var btnContainer = document.getElementById("myBtnContainer");
  var btns = btnContainer.getElementsByClassName("btn-nav");
  for (var i = 0; i < btns.length; i++) {
    btns[i].addEventListener("click", function () {
      var current = document.getElementsByClassName("active");
      current[0].className = current[0].className.replace(" active", "");
      this.className += " active";
    });
  }

  // FAVORITES FUNCTIONS
  async function addToFavorites(imageUrl) {
    try {
      const favoritesRef = db.collection("favorites");
      const snapshot = await favoritesRef.where("url", "==", imageUrl).get();

      if (snapshot.empty) {
        await favoritesRef.add({ url: imageUrl, timestamp: Date.now() });
        console.log("Added to favorites!");
      } else {
        // remove from favorites (toggle)
        const docId = snapshot.docs[0].id;
        await favoritesRef.doc(docId).delete();
        console.log("Removed from favorites!");
      }
    } catch (error) { console.error("Error adding/removing favorite:", error); }
  }

  // ON PAGE LOAD
  window.onload = async function() {
    const imgs = document.querySelectorAll('.filterDiv img');
    const favoritesSnapshot = await db.collection("favorites").get();
    const favUrls = favoritesSnapshot.docs.map(doc => doc.data().url);

    imgs.forEach(img => {
      if (favUrls.includes(img.src)) img.classList.add("favorited");

      img.addEventListener('click', async function() {
        await addToFavorites(this.src);
        this.classList.toggle("favorited");
      });
    });
  };
</script>

</body>
</html>
